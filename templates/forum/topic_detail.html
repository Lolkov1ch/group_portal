{% block content %}
<h1>
    {{ topic.title }}
    {% if topic.is_pinned %}üìå{% endif %}
    {% if topic.is_locked %}üîí{% endif %}
</h1>

<p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: 
    <a href="{% url 'forum:topic_list_by_category' topic.forum.category.id %}">
        {{ topic.forum.category.name }}
    </a>
</p>

{% if user == topic.author or user.is_staff %}
    <div style="margin-top:10px;">
        <a href="{% url 'forum:topic_update' topic.pk %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a> |
        <a href="{% url 'forum:topic_delete' topic.pk %}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
    </div>
{% endif %}

<h2>–í—ñ–¥–ø–æ–≤—ñ–¥—ñ</h2>
{% for post in posts %}
    <div>
        <p>{{ post.content|linebreaks }}</p>
        <small>
            –ê–≤—Ç–æ—Ä: {{ post.author.username }} | 
            –î–∞—Ç–∞: {{ post.created_at|date:"d.m.Y H:i" }}
            {% if post.is_edited %}(—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ){% endif %}
        </small>
    </div>
{% empty %}
    <p>–í—ñ–¥–ø–æ–≤—ñ–¥—ñ —â–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ.</p>
{% endfor %}

{% if user.is_authenticated %}
    {% if not topic.is_locked %}
        <h3>–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</h3>
        <form action="{% url 'forum:topic_detail' topic.pk %}" method="post">
            {% csrf_token %}
            {{ reply_form.as_p }}
            <button type="submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </form>
    {% else %}
        <p>–¢–µ–º–∞ –∑–∞–∫—Ä–∏—Ç–∞ –¥–ª—è –Ω–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.</p>
    {% endif %}
{% endif %}

{% if user.is_staff %}
    <div style="margin-top:10px;">
        <form action="{% url 'forum:toggle_pin' topic.pk %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit">
                {% if topic.is_pinned %}–í—ñ–¥–∫—Ä—ñ–ø–∏—Ç–∏{% else %}–ó–∞–∫—Ä—ñ–ø–∏—Ç–∏{% endif %} üìå
            </button>
        </form>

        <form action="{% url 'forum:toggle_lock' topic.pk %}" method="post" style="display:inline; margin-left:8px;">
            {% csrf_token %}
            <button type="submit">
                {% if topic.is_locked %}–í—ñ–¥–∫—Ä–∏—Ç–∏{% else %}–ó–∞–∫—Ä–∏—Ç–∏{% endif %} üîí
            </button>
        </form>
    </div>
{% endif %}
{% endblock %}
